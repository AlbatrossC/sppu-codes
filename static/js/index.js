console.log(`
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ü‚†Ä‚†Ä‚†Ä‚¢Ä‚£¥‚£∂‚£∂‚£∂‚£∂‚£Ñ‚†Ä‚£Ä‚£¥‚£∂‚£∂‚£∂‚£∂‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£¶‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢à‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£∏‚£ø‚£ø‚£Ä‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚¢ø‚¢ø‚£ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚¢æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ü‚††‚£ø‚°ø‚£ø‚£ø‚£ø‚¢ø‚£ø‚£¶‚£¥‚£ø‚°ø‚†ø‚¢ø‚£ø‚£∑‚£Ñ‚†Ä‚¢æ‚£ø‚£ø‚£ø‚£ø‚°ø‚£ø‚†Ü‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ø‚£ø‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£ø‚°ø‚†Å‚†Ä‚£∞‚£ø‚°ø‚†Å‚†Ä‚†Ä‚†Ä‚†à‚†ª‚£ø‚£ß‚°Ä‚†Ä‚†ò‚£ø‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£ø‚£ß‚°Ä‚†Ä‚¢∞‚£ø‚°ø‚†Å‚†Ä‚†Ä‚£ø‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£ø‚£á‚†Ä‚†Ä‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†π‚£ø‚£∑‚£¥‚£ø‚°ü‚†Ä‚†Ä‚†Ä‚¢∞‚£ø‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£ø‚£ø‚°è‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚†á‚†Ä‚†Ä‚£ø‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£ø‚£ø‚£á‚£Ä‚°Ä ‚†Ä‚†ò‚¢ø‚£ø‚£¶‚£Ä‚†Ä‚¢Ä‚£†‚£æ‚£ø‚†è‚†Ä‚†Ä ‚¢ø‚£ø‚£¶‚°Ä‚†Ä‚†Ä‚£Ä‚£º‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ª‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ø‚¢ø‚£ø‚£ø‚†ø‚†õ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ø‚¢ø‚£ø‚£ø‚°ø‚†ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
    
    
            Hey, you! üëÄ Guess what?
                Sppu Codes is open-source
                    and totally free to explore! üéâ
                        Dive in: https://github.com/AlbatrossC/sppu-codes
            ‚†Ä
    `);

(function () {
    // Function to load Google Tag Manager asynchronously
    function loadGTM() {
        var script = document.createElement('script');
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-1R5FFVKTF8';
        script.async = true;

        script.onload = function () {
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                window.dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'G-1R5FFVKTF8');
        };

        document.head.appendChild(script);
    }

    // Defer loading of GTM until after the page has loaded
    if (document.readyState === 'complete') {
        loadGTM(); // If the page is already loaded, load GTM immediately
    } else {
        window.addEventListener('load', function () {
            loadGTM(); // Load GTM after the page has fully loaded
        });
    }
})();

document.addEventListener('DOMContentLoaded', function () {
    // Header elements
    const header = document.querySelector('header');
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const headerActions = document.querySelector('.header__actions');
    const searchInput = document.querySelector('#subject-search');
    const searchDropdown = document.createElement('div');
    searchDropdown.className = 'search-dropdown';
    document.body.appendChild(searchDropdown);

    // Mobile search toggle
    const mobileSearchToggle = document.querySelector('.mobile-search-toggle');
    const searchContainer = document.querySelector('.search-container');

    function closeMobileSearch() {
        if (window.innerWidth <= 768) {
            searchContainer.classList.remove('active');
        }
    }

    if (mobileSearchToggle) {
        mobileSearchToggle.addEventListener('click', function (e) {
            e.stopPropagation();
            searchContainer.classList.toggle('active');
            if (searchContainer.classList.contains('active')) {
                setTimeout(() => searchInput.focus(), 100);
            }
        });
    }

    // Hide search bar on mobile when clicking outside
    document.addEventListener('click', function (e) {
        if (
            window.innerWidth <= 768 &&
            searchContainer.classList.contains('active') &&
            !searchContainer.contains(e.target) &&
            !mobileSearchToggle.contains(e.target)
        ) {
            searchContainer.classList.remove('active');
            searchDropdown.style.display = 'none';
        }
    });

    // Hide search bar on mobile when pressing Escape
    document.addEventListener('keydown', function (e) {
        if (window.innerWidth <= 768 && e.key === 'Escape') {
            closeMobileSearch();
            searchDropdown.style.display = 'none';
        }
    });

    // Load data from all JSON files in the questions folder
    let searchData = [];
    const maxResults = 8;

    // Levenshtein distance for fuzzy matching
    function levenshtein(a, b) {
        if (a.length === 0) return b.length;
        if (b.length === 0) return a.length;
        const matrix = [];
        for (let i = 0; i <= b.length; i++) matrix[i] = [i];
        for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                if (b.charAt(i - 1).toLowerCase() === a.charAt(j - 1).toLowerCase()) {
                    matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j - 1] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j] + 1
                    );
                }
            }
        }
        return matrix[b.length][a.length];
    }

    async function loadSearchData() {
        try {
            const response = await fetch('/api/error-page-data');
            const data = await response.json();

            // Separate and tag results for sorting and styling
            const codeResults = data.subjects.map(subject => ({
                type: 'CODE',
                emoji: 'üíª',
                subjectName: subject.name,
                branchName: '',
                link: subject.href,
                subjectCode: subject.code || '', // Add code for short form search
            }));
            const qpResults = data.questionPapers.map(paper => ({
                type: 'QUESTION PAPER',
                emoji: 'üìÑ',
                subjectName: paper.name,
                branchName: paper.branch,
                link: paper.href,
                subjectCode: '', // No code for question paper
            }));

            // Always show question papers first, then codes
            searchData = [...qpResults, ...codeResults];
        } catch (error) {
            console.error('Failed to load search data:', error);
        }
    }

    // Position dropdown below the search bar
    function positionDropdown() {
        const isMobile = window.innerWidth <= 768;
        if (isMobile) {
            searchDropdown.style.position = 'fixed';
            searchDropdown.style.top = (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) || 70) + 'px';
            searchDropdown.style.left = '0px';
            searchDropdown.style.width = '100vw';
        } else {
            const rect = searchInput.getBoundingClientRect();
            searchDropdown.style.position = 'absolute';
            searchDropdown.style.top = `${rect.bottom + window.scrollY}px`;
            searchDropdown.style.left = `${rect.left + window.scrollX}px`;
            searchDropdown.style.width = `${rect.width}px`;
        }
    }

    // Highlight matched text
    function highlightMatch(text, query) {
        if (!query) return text;
        // Highlight all occurrences, case-insensitive
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    // Improved filter logic: startswith > contains > fuzzy
    let searchResults = [];
    function filterResults(query) {
        const lowerQuery = query.toLowerCase();

        // Helper to check if a string starts with query
        function startsWith(str) {
            return str.toLowerCase().startsWith(lowerQuery);
        }
        // Helper to check if a string contains query
        function contains(str) {
            return str.toLowerCase().includes(lowerQuery);
        }
        // Helper for fuzzy match (Levenshtein distance <= 2)
        function fuzzy(str) {
            return levenshtein(str.toLowerCase(), lowerQuery) <= 2;
        }

        // 1. Results that start with query (subjectName or subjectCode)
        const startsWithResults = searchData.filter(item =>
            startsWith(item.subjectName) || (item.subjectCode && startsWith(item.subjectCode))
        );
        // 2. Results that contain query (subjectName or subjectCode), but not startswith
        const containsResults = searchData.filter(item =>
            !startsWith(item.subjectName) && !startsWith(item.subjectCode || '') &&
            (contains(item.subjectName) || (item.subjectCode && contains(item.subjectCode)))
        );
        // 3. Fuzzy matches (subjectName or subjectCode), but not already included
        const fuzzyResults = searchData.filter(item => {
            if (
                startsWith(item.subjectName) || (item.subjectCode && startsWith(item.subjectCode)) ||
                contains(item.subjectName) || (item.subjectCode && contains(item.subjectCode))
            ) return false;
            return (
                fuzzy(item.subjectName) ||
                (item.subjectCode && fuzzy(item.subjectCode))
            );
        });

        searchResults = [...startsWithResults, ...containsResults, ...fuzzyResults];
    }

    // Render search results
    function renderResults() {
        searchDropdown.innerHTML = '';
        if (searchResults.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'search-no-results';
            noResults.textContent = `No subject found for "${searchInput.value}". Try checking spelling or using a shorter name.`;
            searchDropdown.appendChild(noResults);
            return;
        }

        searchResults.slice(0, maxResults).forEach(result => {
            const row = document.createElement('div');
            row.className = `search-result-row ${result.type === 'QUESTION PAPER' ? 'qp-row' : 'code-row'}`;
            // Highlight both subjectName and subjectCode
            let nameHtml = highlightMatch(result.subjectName, searchInput.value);
            if (result.subjectCode) {
                // Show code in parentheses if present
                nameHtml += ` <span class="result-shortcode">(${highlightMatch(result.subjectCode, searchInput.value)})</span>`;
            }
            row.innerHTML = `
                <span class="result-type-label">
                    <span class="result-emoji">${result.emoji}</span>
                    <span class="result-type-text">${result.type === 'QUESTION PAPER' ? 'Question Paper' : 'Code'}</span>
                </span>
                <span class="result-main">
                    <span class="result-name">${nameHtml}</span>
                    ${result.branchName ? `<span class="result-branch">‚Äì ${result.branchName}</span>` : ''}
                </span>
            `;
            row.addEventListener('click', () => {
                window.location.href = result.link;
            });
            searchDropdown.appendChild(row);
        });
    }

    // Header scroll effect
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
    });

    // Mobile menu toggle functionality
    mobileMenuToggle.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent event from bubbling up
        isMenuOpen = !isMenuOpen;
        headerActions.classList.toggle('active');
        searchContainer.classList.toggle('active');
        mobileMenuToggle.classList.toggle('active');
        mobileMenuToggle.setAttribute('aria-expanded', isMenuOpen);
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (event) => {
        const isClickInsideHeader = header.contains(event.target);
        const isClickOnToggle = mobileMenuToggle.contains(event.target);

        if (!isClickInsideHeader && !isClickOnToggle && isMenuOpen) {
            isMenuOpen = false;
            headerActions.classList.remove('active');
            searchContainer.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            mobileMenuToggle.setAttribute('aria-expanded', false);
        }
    });

    // Handle window resize
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            if (window.innerWidth > 768 && isMenuOpen) {
                isMenuOpen = false;
                headerActions.classList.remove('active');
                searchContainer.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                mobileMenuToggle.setAttribute('aria-expanded', false);
            }
        }, 250);
    });

    // Handle input events
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.trim();
        if (query === '') {
            searchDropdown.style.display = 'none';
            return;
        }
        filterResults(query);
        renderResults();
        positionDropdown();
        searchDropdown.style.display = 'block';
    });

    // Close dropdown on outside click
    document.addEventListener('click', event => {
        if (!searchInput.contains(event.target) && !searchDropdown.contains(event.target)) {
            searchDropdown.style.display = 'none';
        }
    });

    // Close dropdown on escape key
    document.addEventListener('keydown', event => {
        if (event.key === 'Escape') {
            searchDropdown.style.display = 'none';
        }
    });

    // Load data on page load
    loadSearchData();
});