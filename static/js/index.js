console.log(`
    â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â£¿â£¿â£¿â£¿â¡†â €â €â €â¢€â£´â£¶â£¶â£¶â£¶â£„â €â£€â£´â£¶â£¶â£¶â£¶â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â¢ â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â¢ˆâ£¿â£¿â €â €â €â €â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â ¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â €â ˆâ »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ‹â €â €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â¢€â£€â£¸â£¿â£¿â£€â£€â¡€â €â €â €â €â €â €â ˆâ »â¢¿â¢¿â£¿â£¿â£¿â Ÿâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â ¸â ¿â ¿â ¿â ¿â ¿â ¿â ‡â €â €â €â €â €â €â €â €â €â ˆâ ™â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â¢¾â£¿â£¿â£¿â£¿â£¿â£¿â †â  â£¿â¡¿â£¿â£¿â£¿â¢¿â£¿â£¦â£´â£¿â¡¿â ¿â¢¿â£¿â£·â£„â €â¢¾â£¿â£¿â£¿â£¿â¡¿â£¿â †â¢¸â£¿â£¿â£¿â£¿â£¿â¡†â €â €â €â €
    â €â €â €â €â €â €â ˆâ¢¿â£¿â£§â €â €â €â €â£ â£¿â¡¿â â €â£°â£¿â¡¿â â €â €â €â ˆâ »â£¿â£§â¡€â €â ˜â£¿â¡Ÿâ €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â¢»â£¿â£§â¡€â €â¢°â£¿â¡¿â â €â €â£¿â£¿â â €â €â €â €â €â €â¢»â£¿â£‡â €â €â£¿â¡‡â €â €â €â €â €â ¸â£¿â£¿â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â ¹â£¿â£·â£´â£¿â¡Ÿâ €â €â €â¢°â£¿â¡Ÿâ €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â£¿â¡‡â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â ™â£¿â£¿â¡â €â €â €â €â ˜â£¿â£§â €â €â €â €â €â €â €â¢¸â£¿â£¿â €â €â£¿â¡‡â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â €â €â €â£¿â£¿â¡€â €â €â €â €â €â£¿â£¿â¡„â €â €â €â €â €â €â£¿â£¿â ‡â €â €â£¿â£§â €â €â €â €â €â¢¸â£¿â£¿â €â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â¢€â£€â£€â£¿â£¿â£‡â£€â¡€ â €â ˜â¢¿â£¿â£¦â£€â €â¢€â£ â£¾â£¿â â €â € â¢¿â£¿â£¦â¡€â €â €â£€â£¼â£¿â €â €â €â €â €â €
    â €â €â €â €â €â €â €â €â »â ¿â ¿â ¿â ¿â ¿â ¿â ¿â €â €â €â €â ™â ¿â¢¿â£¿â£¿â ¿â ›â â €â €â €â €â €â ™â ¿â¢¿â£¿â£¿â¡¿â Ÿâ €â €â €â €â €
    
    
            Hey, you! ðŸ‘€ Guess what?
                Sppu Codes is open-source
                    and totally free to explore! ðŸŽ‰
                        Dive in: https://github.com/AlbatrossC/sppu-codes
            â €
    `);
// ... [Keep the initial console.log ASCII art exactly as it is] ...

(function () {
    /* =====================================================
       GOOGLE TAG (UNCHANGED)
    ===================================================== */
    function loadGTM() {
        const script = document.createElement('script');
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-1R5FFVKTF8';
        script.async = true;
        script.onload = function () {
            window.dataLayer = window.dataLayer || [];
            function gtag() { window.dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-1R5FFVKTF8');
        };
        document.head.appendChild(script);
    }

    if (document.readyState === 'complete') {
        loadGTM();
    } else {
        window.addEventListener('load', loadGTM);
    }
})();

document.addEventListener('DOMContentLoaded', function () {
    /* =====================================================
       ELEMENTS
    ===================================================== */
    const searchInput = document.getElementById('subject-search');
    const mobileSearchToggle = document.querySelector('.mobile-search-toggle');
    const searchContainer = document.querySelector('.search-container');
    const header = document.querySelector('header');

    // Always attach dropdown to body (not .search-container)
    let searchDropdown = document.querySelector('.search-dropdown');
    if (!searchDropdown) {
        searchDropdown = document.createElement('div');
        searchDropdown.className = 'search-dropdown';
        document.body.appendChild(searchDropdown);
    }

    // Ensure search bar is visible on desktop
    function updateSearchBarVisibility() {
        if (window.innerWidth >= 900) {
            searchContainer.classList.add('active');
            searchContainer.style.display = 'block';
        } else {
            searchContainer.classList.remove('active');
            searchContainer.style.display = '';
        }
    }
    updateSearchBarVisibility();
    window.addEventListener('resize', updateSearchBarVisibility);

    let isLoaded = false;
    const MAX_RESULTS = 10;

    const searchData = {
        questionPapers: [],
        codes: []
    };

    // Normalize for search
    function normalize(str) {
        if (!str) return "";
        return str
            .toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, ' ')
            .trim();
    }

    // Fuzzy score for search
    function fuzzyScore(query, target, code = "") {
        if (!query || (!target && !code)) return Infinity;
        query = normalize(query);
        target = normalize(target);
        code = normalize(code);

        if (target.startsWith(query) || code.startsWith(query)) return 0;
        if (target.includes(query) || code.includes(query)) return 1;

        // Try matching each token
        const qTokens = query.split(' ');
        const tTokens = target.split(' ');
        let hits = 0;
        qTokens.forEach(qt => {
            if (tTokens.some(tt => tt.startsWith(qt)) || code.startsWith(qt)) hits++;
        });
        if (hits > 0) return 2 - hits * 0.1;

        // Levenshtein fallback
        return Math.min(
            levenshtein(query, target),
            code ? levenshtein(query, code) : 99
        );
    }

    function levenshtein(a, b) {
        if (a.length === 0) return b.length;
        if (b.length === 0) return a.length;
        const matrix = [];
        for (let i = 0; i <= b.length; i++) matrix[i] = [i];
        for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                if (b[i - 1] === a[j - 1]) matrix[i][j] = matrix[i - 1][j - 1];
                else matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);
            }
        }
        return matrix[b.length][a.length];
    }

    // Hardcoded subject codes and names as fallback (from index.html)
    const HARDCODED_SUBJECTS = [
        { subject_code: "oopl", subject_name: "Object-Oriented Programming Lab" },
        { subject_code: "cgl", subject_name: "Computer Graphics Lab" },
        { subject_code: "dsl", subject_name: "Data Structures Laboratory" },
        { subject_code: "iotl", subject_name: "Internet of Things Laboratory" },
        { subject_code: "dsal", subject_name: "Data Structures and Algorithms Laboratory" },
        { subject_code: "dbms", subject_name: "DataBase Management Systems" },
        { subject_code: "cnl", subject_name: "Computer Networks Laboratory" },
        { subject_code: "ai", subject_name: "Artificial Intelligence Laboratory" }
    ];

    // Load search data (with subject codes, fallback to hardcoded if needed)
    async function loadSearchData() {
        if (isLoaded) return;
        try {
            // Question Papers
            const qpRes = await fetch('/api/question-papers/search');
            const qpData = await qpRes.json();
            searchData.questionPapers = qpData.map(item => ({
                type: 'QUESTION_PAPER',
                label: 'ðŸ“„ QP',
                subjectName: item.subject_name,
                subjectCode: '', // Not available for QP
                link: item.link,
                branch: item.branch
            }));

            // Codes (Subjects)
            let codeData = [];
            try {
                const codeRes = await fetch('/api/subjects/search');
                codeData = await codeRes.json();
            } catch (e) {
                // fallback to hardcoded
                codeData = [];
            }
            // If API returns nothing, fallback to hardcoded
            if (!Array.isArray(codeData) || codeData.length === 0) {
                codeData = HARDCODED_SUBJECTS;
            }
            searchData.codes = codeData.map(s => ({
                type: 'CODE',
                label: 'ðŸ’» Code',
                subjectName: s.subject_name,
                subjectCode: s.subject_code,
                link: s.url || `/${s.subject_code}`
            }));

            isLoaded = true;
        } catch (err) {
            // fallback to hardcoded if everything fails
            searchData.codes = HARDCODED_SUBJECTS.map(s => ({
                type: 'CODE',
                label: 'ðŸ’» Code',
                subjectName: s.subject_name,
                subjectCode: s.subject_code,
                link: `/${s.subject_code}`
            }));
            isLoaded = true;
            console.error('Search data load failed:', err);
        }
    }

    // Show/hide search bar on mobile
    if (mobileSearchToggle) {
        mobileSearchToggle.addEventListener('click', async (e) => {
            e.stopPropagation();
            searchContainer.classList.toggle('active');
            if (searchContainer.classList.contains('active')) {
                await loadSearchData();
                setTimeout(() => searchInput.focus(), 100);
            } else {
                searchDropdown.style.display = 'none';
            }
        });
    }

    // Filter & sort supports subject codes, but only show relevant matches
    function filterAndSort(query) {
        const resultsQP = [];
        const resultsCode = [];

        searchData.questionPapers.forEach(item => {
            const score = fuzzyScore(query, item.subjectName);
            if (score <= 3) resultsQP.push({ ...item, score });
        });

        searchData.codes.forEach(item => {
            const scoreName = fuzzyScore(query, item.subjectName, item.subjectCode);
            const scoreCode = fuzzyScore(query, item.subjectCode || "");
            const score = Math.min(scoreName, scoreCode);
            // Only show if query matches subject name or code reasonably
            if (score <= 2) resultsCode.push({ ...item, score });
        });

        resultsQP.sort((a, b) => a.score - b.score);
        resultsCode.sort((a, b) => a.score - b.score);
        return { resultsQP, resultsCode };
    }

    // Highlight matched text
    function highlight(text, query) {
        if (!query) return text;
        const normQuery = normalize(query);
        if (!normQuery) return text;
        // Highlight only if query is present in text
        const regex = new RegExp(`(${query})`, 'ig');
        return text.replace(regex, '<mark>$1</mark>');
    }

    // Render results (show subject code as badge, but do not link it, and improve styling)
    function renderResults(qp, codes) {
        searchDropdown.innerHTML = '';

        function renderSection(title, items, typeClass) {
            if (!items.length) return;

            const section = document.createElement('div');
            section.className = 'search-section';
            const header = document.createElement('div');
            header.className = 'search-section-header';
            header.textContent = title;
            section.appendChild(header);

            const list = document.createElement('div');
            list.className = 'search-section-list';

            items.slice(0, MAX_RESULTS).forEach(item => {
                const row = document.createElement('div');
                row.className = `search-result-row ${typeClass}`;

                let badge = '';
                if (typeClass === 'code-row' && item.subjectCode) {
                    badge = `<span class="result-shortcode">${item.subjectCode.toUpperCase()}</span>`;
                } else if (typeClass === 'qp-row' && item.branch) {
                    badge = `<span class="result-branch">${item.branch}</span>`;
                }

                // Single-row horizontal layout
                row.innerHTML = `
                    <span class="result-name">${highlight(item.subjectName, searchInput.value)}</span>
                    ${badge ? badge : ''}
                    <span class="result-type-label">
                        ${typeClass === 'qp-row'
                            ? '<svg style="width:1em;height:1em;margin-right:3px;" fill="none" stroke="#2d76cc" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/></svg>'
                            : '<svg style="width:1em;height:1em;margin-right:3px;" fill="none" stroke="#2d76cc" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4"/><path d="M8 3v4"/></svg>'
                        }
                        ${typeClass === 'qp-row' ? 'QP' : 'CODE'}
                    </span>
                `;

                row.onclick = () => {
                    if (item.link) {
                        window.location.href = item.link;
                    }
                };
                list.appendChild(row);
            });

            section.appendChild(list);
            searchDropdown.appendChild(section);
        }

        renderSection('Question Papers', qp, 'qp-row');
        renderSection('Codes', codes, 'code-row');

        if (!qp.length && !codes.length) {
            searchDropdown.innerHTML = `<div class="search-no-results">No results found for "${searchInput.value}"</div>`;
        }
    }

    // Position dropdown below search input, responsive for mobile/desktop
    function positionDropdown() {
        const rect = searchInput.getBoundingClientRect();
        if (window.innerWidth <= 900) {
            searchDropdown.style.position = 'fixed';
            searchDropdown.style.top = `${header.offsetHeight}px`;
            searchDropdown.style.left = '0';
            searchDropdown.style.width = '100vw';
            searchDropdown.style.maxWidth = '100vw';
        } else {
            searchDropdown.style.position = 'absolute';
            searchDropdown.style.top = `${rect.bottom + window.scrollY}px`;
            searchDropdown.style.left = `${rect.left + window.scrollX}px`;
            searchDropdown.style.width = `${rect.width}px`;
            searchDropdown.style.maxWidth = `${rect.width}px`;
        }
        searchDropdown.style.display = 'block';
        searchDropdown.style.zIndex = 3000;
    }

    // Show dropdown on focus/input
    searchInput.addEventListener('focus', async () => {
        await loadSearchData();
        const query = searchInput.value.trim();
        if (!query) {
            searchDropdown.style.display = 'none';
            return;
        }
        const { resultsQP, resultsCode } = filterAndSort(query);
        renderResults(resultsQP, resultsCode);
        positionDropdown();
    });

    searchInput.addEventListener('input', async () => {
        const query = searchInput.value.trim();
        if (!query) {
            searchDropdown.style.display = 'none';
            return;
        }
        await loadSearchData();
        const { resultsQP, resultsCode } = filterAndSort(query);
        renderResults(resultsQP, resultsCode);
        positionDropdown();
    });

    // Hide dropdown on click outside or blur
    document.addEventListener('mousedown', (e) => {
        if (!searchDropdown.contains(e.target) && e.target !== searchInput) {
            searchDropdown.style.display = 'none';
        }
    });
    searchInput.addEventListener('blur', () => {
        setTimeout(() => { searchDropdown.style.display = 'none'; }, 150);
    });

    // Keyboard navigation (arrow keys, enter)
    searchInput.addEventListener('keydown', function (e) {
        const rows = Array.from(searchDropdown.querySelectorAll('.search-result-row'));
        let idx = rows.findIndex(row => row.classList.contains('active'));
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (rows.length) {
                if (idx >= 0) rows[idx].classList.remove('active');
                idx = (idx + 1) % rows.length;
                rows[idx].classList.add('active');
                rows[idx].scrollIntoView({ block: 'nearest' });
            }
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (rows.length) {
                if (idx >= 0) rows[idx].classList.remove('active');
                idx = (idx - 1 + rows.length) % rows.length;
                rows[idx].classList.add('active');
                rows[idx].scrollIntoView({ block: 'nearest' });
            }
        } else if (e.key === 'Enter') {
            e.preventDefault();
            if (idx >= 0 && rows[idx]) {
                rows[idx].click();
            }
        }
    });
});