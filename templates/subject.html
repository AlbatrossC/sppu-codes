<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <meta name="description" content="{{ description }}">
    <meta name="keywords" content="{{ keywords | join(', ') }}">
    <meta name="google-adsense-account" content="ca-pub-6918638598461716">
    <meta property="og:url" content="{{ url }}">
    <link rel="canonical" href="{{ url }}">
    <link rel="stylesheet" href="/static/css/answerbox.css?v=1.8">
    <link rel="stylesheet" href="/static/css/subjectlayout.css?v=1.9">
    <script src="/static/js/script.js" defer></script>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6918638598461716"
         crossorigin="anonymous"></script>
    
    {% if question %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "QAPage",
                "mainEntity": {
                    "@type": "Question",
                    "name": "Q{{ question.question_no }}: {{ question.question | escape }}",
                    "text": "Q{{ question.question_no }}: {{ question.question | escape }}",
                    "answerCount": {{ question.file_name | length if question.file_name is iterable else 1 }},
                    "acceptedAnswer": [
                        {% for f_name in question.file_name %}
                        {
                            "@type": "Answer",
                            "text": "Code file: {{ f_name }} for question: {{ question.question | escape }}",
                            "author": "Sppu Codes",
                            "url": "sppucodes.vercel.app/{{ subject_code }}/{{ question.id }}#file={{ f_name | urlencode }}"
                        }{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ]
                }
            },
            {
                "@type": "WebPage",
                "name": "{{ title }}",
                "description": "{{ description }}",
                "url": "{{ url }}",
                "keywords": "{{ keywords | join(', ') }}"
            }
        ]
    }
    </script>
    {% else %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {% for group in sorted_groups %}
                {% set outer_loop = loop %}
                {% for question_item in groups[group] %}
                {
                    "@type": "Question",
                    "name": "Q{{ question_item.question_no }}: {{ question_item.question | escape }}",
                    "acceptedAnswer": [
                        {% for f_name in question_item.file_name %}
                        {
                            "@type": "Answer",
                            "text": "Code file: {{ f_name }} for question: {{ question_item.question | escape }}",
                            "author": "Sppu Codes",
                            "url": "sppucodes.vercel.app/{{ subject_code }}/{{ question_item.id }}#file={{ f_name | urlencode }}"
                        }{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ]
                }{% if not (loop.last and outer_loop.last) %},{% endif %}
                {% endfor %}
            {% endfor %}
        ]
    }
    </script>
    {% endif %}

    <style>
    /* Desktop Side Rail Ads CSS */
    .ads-container {
        position: fixed;
        top: 0;
        height: 100vh;
        width: 170px;
        z-index: 100;
        pointer-events: none;
    }

    .ads-container.left-ads {
        left: 0;
    }

    .ads-container.right-ads {
        right: 0;
    }

    .ad-rail {
        position: sticky;
        top: 80px;
        height: calc(100vh - 80px);
        width: 100%;
        pointer-events: auto;
        padding: 5px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 20px;
    }

    .ad-slot {
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }

    /* Wide Skyscraper Ad for Desktop */
    .ad-slot.wide-skyscraper {
        height: 600px;
        width: 160px;
    }

    /* Mobile Banner Ad */
    .mobile-ad-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background-color: var(--color-bg-secondary, #1e1e1e);
        border-top: 1px solid var(--color-border, #333);
        padding: 10px;
        display: none;
        justify-content: center;
        align-items: center;
    }

    .mobile-ad-container .ad-slot {
        height: 50px;
        width: 300px;
        max-width: 90vw;
    }

    /* Main content adjustment for desktop */
    @media (min-width: 1200px) {
        body {
            padding-left: 180px;
            padding-right: 180px;
        }
        
        .ads-container {
            display: block;
        }
        
        .mobile-ad-container {
            display: none;
        }
    }

    /* Mobile and tablet styles */
    @media (max-width: 1199px) {
        .ads-container {
            display: none;
        }
        
        body {
            padding-left: 0;
            padding-right: 0;
            padding-bottom: 80px; /* Space for mobile ad */
        }
        
        .mobile-ad-container {
            display: flex;
        }
    }

    /* Ensure content wrapper maintains its structure */
    .content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.5rem;
    }

    /* Header adjustments - Full width on desktop */
    header {
        width: 100%;
        max-width: none;
        margin: 0;
        padding: 1rem;
        box-sizing: border-box;
    }

    /* Ensure header content is centered but header spans full width */
    @media (min-width: 1200px) {
        header {
            margin-left: -180px;
            margin-right: -180px;
            width: calc(100% + 360px);
        }
        
        header > * {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }
    }

    /* AdSense styling - clean and policy compliant */
    .adsbygoogle {
        display: block !important;
        background: transparent !important;
        border: none !important;
    }
    </style>
</head>
<body>
    <!-- Left Side Desktop Ad Rail -->
    <div class="ads-container left-ads">
        <div class="ad-rail">
            <div class="ad-slot wide-skyscraper">
                <!-- Left Side Google AdSense Wide Skyscraper Ad -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:160px;height:600px"
                    data-ad-client="ca-pub-6918638598461716"
                    data-ad-slot="1223389585"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
    </div>

    <div class="ads-container right-ads">
        <div class="ad-rail">
            <div class="ad-slot wide-skyscraper">
                <ins class="adsbygoogle"
                    style="display:inline-block;width:160px;height:600px"
                    data-ad-client="ca-pub-6918638598461716"
                    data-ad-slot="3985284299"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
    </div>

    
    <!-- Mobile Ad Container (Fixed at bottom) -->
    <div class="mobile-ad-container" id="mobileAdContainer">
        <div class="ad-slot">
            <!-- Mobile Banner Ad -->
            <ins class="adsbygoogle"
                style="display:inline-block;width:300px;height:50px"
                data-ad-client="ca-pub-6918638598461716"
                data-ad-slot="2408478746"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>


    <header>
        <div>
            <h3>
                <a href="/{{ subject_code }}" class="a">{{ subject_name }} ({{ subject_code }}) Codes</a>
            </h3>
            <div style="display:flex;gap:0.5rem;">
                <button onclick="location.href='/'" class="home-btn" aria-label="Go to home page">Home</button>
                
                {% if question_paper_url %}
                <button onclick="location.href='{{ question_paper_url }}'" 
                        class="qp-btn" 
                        aria-label="View Question Papers">
                    View Question Papers
                </button>
                {% endif %}
            </div>
        </div>
    </header>


    <div class="info-box">
        <p>
            If the code doesn't load, you can check it out on 
            <a href="https://github.com/AlbatrossC/codes/tree/main/answers/{{ subject_code }}" target="_blank" rel="noopener noreferrer">GitHub</a>
        </p>
    </div>

    {% if question %}
    <div class="group">
        <h3>Group {{ question.group }}</h3>
        <article class="question-item" id="{{ question.id }}">
            <h1>
                <strong>Q{{ question.question_no }}: </strong>{{ question.question }}
            </h1>
            {% for file in question.file_name %}
            <!-- UPDATE: Added loop.index to arguments for fileIndex -->
            <button class="view-code-btn"  
                    onclick="loadAnswer('{{ subject_code }}', '{{ question.question_no }}', '{{ question.title }}', this, '{{ file }}', {{ loop.index }})">
                View Code {{ loop.index }}
            </button>
            {% endfor %}
            <div class="answer-box" id="answerBox{{ question.question_no }}">
                <div class="modal-content">
                    <h3 id="questionText{{ question.question_no }}"></h3>
                    <pre id="codeContent{{ question.question_no }}"></pre>
                </div>
                <div class="copy-close-container">
                    <button class="copy-btn" onclick="copyCode('codeContent{{ question.question_no }}')">Copy Code</button>
                    <button class="close-btn" onclick="closeBox('answerBox{{ question.question_no }}')">Close</button>
                </div>
            </div>
        </article>

        <div class="other-questions">
            <div class="other-questions-header">
                <h3>Other Questions in {{ subject_name }}</h3>
                <a href="/{{ subject_code }}" class="see-all-btn">See All Available Questions</a>
            </div>
            <ul class="questions-list">
                {% for group_key in sorted_groups %}
                    {% for q in groups[group_key] %}
                        {% if q.id != question.id %}
                        <li>
                            <a href="/{{ subject_code }}/{{ q.id }}" class="question-link">
                                <strong>Q{{ q.question_no }}: </strong>{{ q.question }}
                            </a>
                        </li>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
    </div>
    {% else %}
    {% for group_key in sorted_groups %}
    <div class="group">
        <h3>Group {{ group_key }}</h3>

        {% for question_item in groups[group_key] %}
        <article class="question-item" id="{{ question_item.id }}">
            <h1>
                <a href="/{{ subject_code }}/{{ question_item.id }}" class="question-link">
                    <strong>Q{{ question_item.question_no }}: </strong>{{ question_item.question }}
                </a>
            </h1>
            {% for file in question_item.file_name %}
            <!-- UPDATE: Added loop.index to arguments for fileIndex -->
            <button class="view-code-btn" 
                    onclick="loadAnswer('{{ subject_code }}', '{{ question_item.question_no }}', '{{ question_item.title }}', this, '{{ file }}', {{ loop.index }})">
                View Code {{ loop.index }}
            </button>
            {% endfor %}
            <div class="answer-box" id="answerBox{{ question_item.question_no }}">
                <div class="modal-content">
                    <h3 id="questionText{{ question_item.question_no }}"></h3>
                    <pre id="codeContent{{ question_item.question_no }}"></pre>
                </div>
                <div class="copy-close-container">
                    <button class="copy-btn" onclick="copyCode('codeContent{{ question_item.question_no }}')">Copy Code</button>
                    <button class="close-btn" onclick="closeBox('answerBox{{ question_item.question_no }}')">Close</button>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    {% endfor %}
    {% endif %}

    <script>
    // Initialize AdSense ads after page load
    window.addEventListener('DOMContentLoaded', function() {
        try {
            // Initialize all AdSense ads
            (adsbygoogle = window.adsbygoogle || []).push({});
            (adsbygoogle = window.adsbygoogle || []).push({});
            (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) {
            console.warn('AdSense initialization failed:', e);
        }
    });
    </script>
</body>
</html>